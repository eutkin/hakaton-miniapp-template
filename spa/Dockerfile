# Stage 1: –°–±–æ—Ä–∫–∞
FROM node:24.9.0 AS builder

WORKDIR /app

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY package*.json ./

# üî• –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Rollup –∏ –µ–≥–æ ARM64-–±–∏–Ω–∞—Ä–Ω–∏–∫ –í–†–£–ß–ù–£–Æ
RUN npm install --save-prod @rollup/rollup-linux-arm64-gnu
RUN npm ci

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞
COPY . .

# –°–±–æ—Ä–∫–∞
RUN npm run build

FROM caddy:2-alpine

COPY --from=builder /app/dist /srv
COPY Caddyfile /etc/caddy/Caddyfile

EXPOSE 80
